openapi: 3.0.1
info:
  title: /
  version: 1.0.0
servers:
- url: "{server}:{port}/"
  variables:
    server:
      default: http://localhost
    port:
      default: "9090"
paths:
  /user-info:
    get:
      summary: Fetch logged-in user's details with privileges.
      operationId: getUserInfo
      responses:
        "200":
          description: Ok
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserInfo'
        "500":
          description: InternalServerError
  /sessions:
    get:
      summary: Fetch all active sessions from the conference backend.
      operationId: getSessions
      responses:
        "200":
          description: Ok
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Session'
        "500":
          description: InternalServerError
  /qr-code:
    post:
      summary: Create a new QR code.
      operationId: postQrCode
      requestBody:
        description: Payload containing the QR details
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateQrCodePayload'
        required: true
      responses:
        "201":
          description: Created
        "400":
          description: BadRequest
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorPayload'
        "500":
          description: InternalServerError
        "403":
          description: Forbidden
  /qr-code/{id}:
    get:
      summary: Fetch a specific QR by ID.
      operationId: getQrCodeId
      parameters:
      - name: id
        in: path
        description: UUID of the QR code
        required: true
        schema:
          type: string
      responses:
        "200":
          description: Ok
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConferenceQrCode'
        "500":
          description: InternalServerError
        "404":
          description: NotFound
        "400":
          description: BadRequest
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorPayload'
    delete:
      summary: Delete a QR code.
      operationId: deleteQrCodeId
      parameters:
      - name: id
        in: path
        description: UUID of the QR code to delete
        required: true
        schema:
          type: string
      responses:
        "500":
          description: InternalServerError
        "204":
          description: NoContent
        "403":
          description: Forbidden
        "404":
          description: NotFound
        "400":
          description: BadRequest
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorPayload'
  /qr-codes:
    get:
      summary: Fetch all QRs with optional filters.
      operationId: getQrCodes
      parameters:
      - name: limit
        in: query
        description: Optional limit for pagination
        schema:
          type: integer
          format: int64
          nullable: true
      - name: offset
        in: query
        description: Optional offset for pagination
        schema:
          type: integer
          format: int64
          nullable: true
      responses:
        "200":
          description: Ok
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConferenceQrCodesResponse'
        "500":
          description: InternalServerError
        "400":
          description: BadRequest
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorPayload'
components:
  schemas:
    AuditFields:
      required:
      - createdBy
      - createdOn
      type: object
      properties:
        createdBy:
          type: string
          description: Who created the QR
        createdOn:
          type: string
          description: When the QR was created
      additionalProperties: false
      description: Database audit fields.
    ConferenceQrCode:
      type: object
      description: "[Database] ConferenceQR record."
      allOf:
      - $ref: '#/components/schemas/AuditFields'
      - required:
        - info
        - qrId
        type: object
        properties:
          qrId:
            type: string
            description: UUID string
          info:
            $ref: '#/components/schemas/QrCodeInfo'
          description:
            type: string
            description: Optional description/note about the QR code
            nullable: true
        additionalProperties: false
    ConferenceQrCodesResponse:
      required:
      - qrs
      - totalCount
      type: object
      properties:
        totalCount:
          type: integer
          description: The total count of QR codes
          format: int64
        qrs:
          type: array
          description: Array of QR codes
          items:
            $ref: '#/components/schemas/ConferenceQrCode'
      additionalProperties: false
      description: Response record for list of QRs.
    CreateQrCodePayload:
      required:
      - info
      type: object
      properties:
        info:
          $ref: '#/components/schemas/QrCodeInfo'
        description:
          type: string
          description: Optional description/note about the QR code
          nullable: true
      additionalProperties: false
      description: Payload for creating a new QR code.
    ErrorPayload:
      required:
      - message
      - method
      - path
      - reason
      - status
      - timestamp
      type: object
      properties:
        timestamp:
          type: string
        status:
          type: integer
          format: int64
        reason:
          type: string
        message:
          type: string
        path:
          type: string
        method:
          type: string
    QrCodeInfo:
      description: The `info` field is a session or o2bar entry.
      oneOf:
      - $ref: '#/components/schemas/QrCodeInfoSession'
      - $ref: '#/components/schemas/QrCodeInfoO2Bar'
    QrCodeInfoO2Bar:
      required:
      - email
      - eventType
      type: object
      properties:
        eventType:
          $ref: '#/components/schemas/QrCodeType'
        email:
          type: string
          description: Contact email when `eventType` is O2BAR
      additionalProperties: false
      description: "[Database] Info entry for an O2 bar QR item."
    QrCodeInfoSession:
      required:
      - eventType
      - sessionId
      type: object
      properties:
        eventType:
          $ref: '#/components/schemas/QrCodeType'
        sessionId:
          type: string
          description: Session identifier when `eventType` is SESSION
      additionalProperties: false
      description: "[Database] Info entry for a speech session QR item."
    QrCodeType:
      type: string
      description: QR info types.
      enum:
      - O2BAR
      - SESSION
    Session:
      required:
      - id
      - name
      - presenter
      type: object
      properties:
        id:
          type: string
          description: Session ID
        name:
          type: string
          description: Session name/title
        presenter:
          type: string
          description: Presenter name
      additionalProperties: false
      description: Session information from conference backend.
    UserInfo:
      required:
      - email
      - privileges
      type: object
      properties:
        email:
          type: string
          description: User email
        privileges:
          type: array
          description: Array of privileges assigned to the user
          items:
            type: integer
            format: int64
      additionalProperties: false
      description: Response for fetching user information.
